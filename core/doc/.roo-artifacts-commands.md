# コマンド一覧

## 1. Compareコマンド
### 基本機能
2つのデータセット間の比較を行います。データの内容比較、画像の差分検出、PDFの比較など、様々な形式の比較に対応しています。比較結果は指定された形式で出力されます。

### 引数
* -targetType: 比較対象のタイプ(data/image/pdf) - [詳細な設定](#targettype)
* -setting: 比較設定ファイルパス - [スキーマ定義](.roo-artifacts-json-schema.md#1-比較設定ファイル-setting)
* -settingEncoding: 設定ファイルのエンコーディング
* new.* : 新データセットの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* old.* : 旧データセットの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* expect.* : 期待値データセットの設定（オプション） - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* result.* : 結果出力オプション - [出力設定の詳細](.roo-artifacts-settings.md#resultoption-result)

### タイプ別オプション
#### targetType
選択可能な値とそれぞれの追加設定:

- data: データセット比較モード
  * setting: テーブル比較設定ファイル
  * settingEncoding: 設定ファイルのエンコーディング

- image: 画像比較モード
  * image.*: [画像比較オプション設定](.roo-artifacts-settings.md#imagecompareoption-image)
  * new/old.srcType: 自動的に'file'に設定
  * new/old.extension: 自動的に'png'に設定

- pdf: PDF比較モード
  * image.*: [画像比較オプション設定](.roo-artifacts-settings.md#imagecompareoption-image)（PDFを画像として比較）
  * new/old.srcType: 自動的に'file'に設定
  * new/old.extension: 自動的に'pdf'に設定

### 使用例
```bash
# データセット比較
dbunit compare -targetType data \
  -new.srcType csv -new.src new_data.csv \
  -old.srcType csv -old.src old_data.csv \
  -result.resultType csv -result.resultDir ./diff

# 画像比較
dbunit compare -targetType image \
  -new.src new_image.png \
  -old.src old_image.png \
  -image.threshold 10 \
  -image.pixelToleranceLevel 0.05 \
  -result.resultDir ./diff
```

## 2. Convertコマンド
### 基本機能
データセットの形式を別の形式に変換します。例えば、CSVからExcel、データベースからCSVなど、様々な形式間の変換に対応しています。

### 引数
* src.* : 変換元データセットの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* result.* : 変換結果の出力設定 - [出力設定の詳細](.roo-artifacts-settings.md#resultoption-result)
* -parameter : パラメータ設定

### 使用例
```bash
# CSVファイルをExcelに変換
dbunit convert \
  -src.srcType csv -src.src input.csv \
  -result.resultType xlsx -result.resultPath output.xlsx

# データベースのテーブルをCSVに出力
dbunit convert \
  -src.srcType table -src.src "SELECT * FROM users" \
  -jdbc.url "jdbc:mysql://localhost/testdb" \
  -jdbc.user "root" -jdbc.pass "password" \
  -result.resultType csv -result.resultDir ./output
```

## 3. Generateコマンド
### 基本機能
テンプレートを使用してファイルを生成します。SQL、設定ファイル、テキストファイル、Excelファイルなど、様々な形式のファイル生成に対応しています。データセットの内容に基づいて動的にファイルを生成できます。

### 引数
* -generateType: 生成タイプ(txt/xlsx/xls/settings/sql) - [詳細な設定](#generatetype)
* -unit: パラメータ化の単位 - [詳細な設定](#パラメータ単位)
* -template: テンプレートファイルパス
* -resultDir: 出力先ディレクトリ
* -resultPath: 出力ファイルパス
* -outputEncoding: 出力エンコーディング
* src.* : ソースデータセットの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* template.* : テンプレート設定 - [テンプレート設定の詳細](.roo-artifacts-settings.md#templaterenderoption-template)

### タイプ別オプション
#### generateType
選択可能な値とそれぞれの設定:
- txt: テキストファイル生成
  * -template: テンプレートファイルパス
  * -unit: [パラメータ単位](#パラメータ単位)を指定して生成

- xlsx/xls: Excelファイル生成
  * -template: テンプレートファイルパス
  * -unit: パラメータ単位を任意に指定可能
    - record: データの各行ごとにシートまたはブックを生成
    - table: テーブルごとにシートまたはブックを生成
    - dataset: データセット全体で1つのブックを生成
  * template.formulaProcess: Excel数式処理の有効化（xlsxのみ）


- settings: 設定ファイル生成
  * 固定テンプレート使用
  * -unit: datasetに固定 - [理由と制約](#コマンド別の制約)
  * src.useJdbcMetaData: 自動的に'true'に設定（メタデータの取得が必要）
  * src.loadData: 自動的に'false'に設定（実データは不要）

- sql: SQLファイル生成
  * 固定テンプレート使用
  * -unit: tableに固定 - [理由と制約](#コマンド別の制約)
  * -operation: SQL操作タイプ
    - INSERT: INSERT文生成
    - DELETE: DELETE文生成
    - UPDATE: UPDATE文生成
    - CLEAN_INSERT: TRUNCATE+INSERT文生成
    - DELETE_INSERT: DELETE+INSERT文生成（デフォルト）
  * -commit: コミット有無（デフォルト: true）
  * -sqlFilePrefix: 生成SQLファイル名のプレフィックス
  * -sqlFileSuffix: 生成SQLファイル名のサフィックス
  * src.useJdbcMetaData: 自動的に'true'に設定

### 使用例
```bash
# テーブルデータからSQL生成
dbunit generate -generateType sql \
  -operation INSERT \
  -src.srcType table -src.src "users" \
  -jdbc.url "jdbc:mysql://localhost/testdb" \
  -resultDir ./sql

# テンプレートを使用してExcelファイル生成
dbunit generate -generateType xlsx \
  -template template.xlsx \
  -src.srcType csv -src.src data.csv \
  -resultPath output.xlsx
```

## 4. Runコマンド
### 基本機能
様々なタイプのスクリプト（SQL、バッチファイル、Antスクリプトなど）を実行します。テンプレート機能と組み合わせることで、動的なスクリプト実行が可能です。

### 引数
* -scriptType: スクリプトタイプ(cmd/bat/sql/ant) - [詳細な設定](#scripttype)
* src.* : 実行するスクリプトファイルの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)

### タイプ別オプション
#### scriptType
選択可能な値とそれぞれの設定:

- cmd/bat: コマンド/バッチスクリプト実行
  * -baseDir: 実行時の基準ディレクトリ
  * src.srcType: 自動的に'file'に設定
  * src.extension: スクリプトの拡張子（cmdまたはbat）

- sql: SQL実行
  * jdbc.*: [データベース接続設定](.roo-artifacts-settings.md#jdbc-データベース接続設定)
  * template.*: [SQLテンプレート設定](.roo-artifacts-settings.md#templaterenderoption-template)
  * src.srcType: 自動的に'file'に設定
  * src.extension: 自動的に'sql'に設定

- ant: Ant実行
  * ant.target: 実行するAntターゲット
  * -baseDir: Ant実行時の基準ディレクトリ
  * src.srcType: 自動的に'file'に設定
  * src.extension: 自動的に'xml'に設定

### 使用例
```bash
# SQLファイルの実行
dbunit run -scriptType sql \
  -src.src "query.sql" \
  -jdbc.url "jdbc:mysql://localhost/testdb" \
  -jdbc.user "root" -jdbc.pass "password"

# Antスクリプトの実行
dbunit run -scriptType ant \
  -src.src "build.xml" \
  -ant.target "compile" \
  -baseDir "./project"
```

## 5. Parameterizeコマンド
### 基本機能
パラメータデータセットの内容に基づいて、指定されたコマンドを繰り返し実行します。各レコードのデータをパラメータとして、テンプレートに適用しながら処理を行います。

### 引数
* -cmd: 実行するコマンド
* -cmdParam: コマンドパラメータ
* -unit: パラメータ単位 - [詳細な設定](#パラメータ単位)
* -template: テンプレートファイルパス
* -ignoreFail: 失敗を無視するかどうか
* -parameterize: パラメータ化を有効にするかどうか
* param.* : パラメータデータセットの設定 - [データソース設定の詳細](.roo-artifacts-settings.md#datasetloadoption-srcnewoldparam)
* template.* : テンプレート設定 - [テンプレート設定の詳細](.roo-artifacts-settings.md#templaterenderoption-template)

### 使用例
```bash
# CSVファイルの各行のデータでSQLを実行
dbunit parameterize \
  -cmd "run" -cmdParam "-scriptType sql" \
  -param.srcType csv -param.src params.csv \
  -template query.sql \
  -unit record

# 複数のデータセットで比較を実行
dbunit parameterize \
  -cmd "compare" \
  -param.srcType csv -param.src test_cases.csv \
  -templateGroup templates \
  -unit dataset

# パラメータ単位

GenerateコマンドとParameterizeコマンドで使用するパラメータ化の単位を指定します。

## record
* 説明：データセットの各行を個別のパラメータとして処理
* パラメータ構造：
```json
{
  "rowNum": "行番号（0から開始）",
  "tableName": "テーブル名",
  "row": {
    "列名1": "値1",
    "列名2": "値2",
    ...
  }
}
```

## table
* 説明：各テーブルを1つのパラメータとして処理
* パラメータ構造：
```json
{
  "tableName": "テーブル名",
  "rows": [
    {
      "列名1": "値1",
      "列名2": "値2",
      ...
    },
    ...
  ]
}
```

## dataset
* 説明：データセット全体を1つのパラメータとして処理
* パラメータ構造：
```json
{
  "dataSet": {
    "テーブル名1": {
      "tableName": "テーブル名1",
      "rows": [
        {
          "列名1": "値1",
          "列名2": "値2",
          ...
        },
        ...
      ]
    },
    "テーブル名2": {
      ...
    }
  }
}
```

### コマンド別の制約
* Generateコマンド
  - txt/xlsx/xls: 任意の単位を指定可能
  - settings: datasetに固定（データセット全体の設定が必要なため）
  - sql: tableに固定（SQLはテーブル単位で生成される必要があるため）
* Parameterizeコマンド
  - すべての単位を指定可能
  - 指定した単位に応じて、パラメータ化されたコマンドが繰り返し実行されます