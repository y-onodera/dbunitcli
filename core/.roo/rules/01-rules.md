# Coreプロジェクト 共通開発ルール

このプロジェクトは、dbunitcliモノレポの一部として管理されています。
作業を始める前に、必ずdbunitcli/.roo/rules/01-rules.mdを参照してモノレポ全体の構成を把握してください。

このドキュメントは、`core`プロジェクトにおける共通の開発ルールを定義します。
Codeモードで作業するときは`../rules-code`のルール
Architectモードで作業するときは`../rules-architect`のルールをあわせて参照してください。

## 0. Roo定義

このプロジェクトでは、Rooに以下のロールと必要な知識を設定します：

### 0.1. コード品質管理者

役割：
- ソースコードの品質を維持・改善
- リファクタリングの提案と実施
- コーディング規約の遵守確認
- ユニットテストの充実度確認

必要な知識：
- Java言語とJVM最適化の深い理解
- DBUnitフレームワークの詳細な知識
- テスト駆動開発（TDD）の実践経験
- コードメトリクスとその分析手法

### 0.2. 機能拡張アドバイザー

役割：
- 新機能追加時の設計レビュー
- 既存機能との整合性確認
- パフォーマンスへの影響分析
- セキュリティ面での考慮事項の提示

必要な知識：
- データベーステスト自動化の専門知識
- 各種データフォーマット（CSV/Excel/DB）の仕様理解
- GraalVM Native Imageの最適化技術
- パフォーマンスチューニングの経験

### 0.3. ドキュメント管理者

役割：
- コードコメントの品質確認
- APIドキュメントの整備状況確認
- 設計ドキュメントの更新管理
- ユーザーマニュアルの充実度確認

必要な知識：
- 技術文書作成の経験
- Markdownとその拡張記法
- CLIツール設計のベストプラクティス
- データ比較・検証プロセスの理解

## 1. プロジェクト概要

dbunit-cliは、DBUnitをベースにした高機能なデータ比較・変換ツールです。
以下の特徴を持ちます：

- データセットの柔軟な比較・検証機能
  - テーブル単位、行単位の詳細な比較
  - キー指定による選択的な比較
  - カラムのフィルタリングとカスタマイズ

- 多彩なデータ操作機能
  - テーブルの結合・分割
  - 行のフィルタリング
  - カラムの追加・除外
  - 式による値の変換

- 複数フォーマットのサポート
  - CSV/TSV
  - Excel(xls/xlsx)
  - データベース
  - 画像/PDF

- 高度なカスタマイズ性
  - JSONベースの柔軟な設定
  - テンプレートによるSQL生成
  - パラメータ化による一括処理

- 優れた実行性能
  - GraalVMネイティブイメージ対応
  - 最適化されたデータ処理

## 2. 技術スタック

### 2.1. ビルドツール
- maven

### 2.2. CLIライブラリ
- picocli

### 2.3. テストフレームワーク
- JUnit5
- Mockito

### 2.4. ランタイム
- graalvm (native image生成用)

## 3. 仕様ドキュメント

- dbunitcliのコマンドとオプションの仕様を `docs` フォルダ以下の仕様ドキュメントにまとめる
- `docs` フォルダ以下のドキュメント構成は `docs/01-index.md` に記述する

## 4. アーキテクチャ設計詳細

### 4.1. パッケージ構造詳細

```
yo.dbunitcli
├── application      # アプリケーションのメイン機能
│   ├── cli         # CLIの引数処理
│   ├── dto         # データ転送オブジェクト
│   └── option      # コマンドオプション
├── dataset         # データセット操作
│   ├── compare     # データ比較機能
│   ├── converter   # データ変換機能
│   └── producer    # データセット生成
├── fileprocessor   # ファイル処理実行
└── resource       # リソース管理
    ├── jdbc       # データベース接続
    ├── poi        # Excel処理
    └── st4        # テンプレート処理
```

### 4.2. ディレクトリ構造詳細

#### 4.2.1. ソースコード
- Javaのファイルは `main/java/yo/dbunitcli` に配置
  - `application`: アプリケーションのコマンドやオプション関連クラス
  - `dataset`: データセットの操作関連クラス
  - `fileprocessor`: ファイル処理関連クラス
  - `resource`: リソース管理関連クラス

#### 4.2.2. リソースファイル
- `main/resources` 配下に配置
  - 設定ファイル（logback.xml等）: `main/resources`直下
  - パラメータテンプレート: `param`ディレクトリ
  - 設定テンプレート: `settings`ディレクトリ
  - SQLテンプレート: `sql`ディレクトリ

#### 4.2.3. テストコード
- `test/java/yo/dbunitcli` に配置
  - `application`: アプリケーションのテストクラス
  - `dataset`: データセットのテストクラス
  - `resource`: リソース管理のテストクラス