# Coreプロジェクト 共通開発ルール

このプロジェクトは、dbunitcliモノレポの一部として管理されています。
このドキュメントは、`core`プロジェクトにおける共通の開発ルールを定義します。

## 0. Roo定義

このプロジェクトでは、Rooに以下のロールと必要な知識を設定します：

必要な知識：
- Java言語とJVM最適化の深い理解
- DBUnitフレームワークの詳細な知識
- コードメトリクスとその分析手法
- GraalVM Native Imageの最適化技術

## 1. タスク管理ルール

### 1.1 タスク構造

- タスクは以下の階層構造で管理します：
  ```
  work/
  ├── tasks/                     # 作業中のタスク用ディレクトリ
  │   └── TASK-{番号}/          
  │       ├── main.md           # メインタスク定義
  │       ├── subtasks/         # サブタスク用ディレクトリ
  │       │   ├── code/         # Codeモード用サブタスク
  │       │   │   └── {番号}.md 
  │       │   ├── docs/         # Docsモード用サブタスク
  │       │   │   └── {番号}.md
  │       │   └── deps.json     # サブタスク間の依存関係定義
  │       └── status.json       # タスク全体の進捗状況
  │
  └── tasks-done/               # 完了タスク用ディレクトリ
      └── TASK-{番号}/          # タスク完了時にtasksからここに移動
          └── [同上の構造]
  ```

### 1.2 タスクファイルの命名規則

1. タスクID
   - 形式: `TASK-{3桁の連番}`
   - 例: TASK-001, TASK-002, ...
   - 新規タスク作成時は`tasks-done`ディレクトリも確認し、未使用の最小の番号を使用

2. メインタスクファイル
   - ファイル名: `main.md`
   - タスク全体の目的、構成、完了条件を定義
   - サブタスクの分割方針と依存関係を記載

3. サブタスクファイル
   - 形式: `{番号}.md`（例：001.md）
   - モードごとのディレクトリに配置
   - サブタスク番号はタスク内で一意の連番

### 1.3 タスクの状態管理

1. メインタスクの状態
   - `Planning`: タスク分析と分割の段階
   - `In Progress`: サブタスク実行中
   - `Review`: すべてのサブタスク完了後の最終確認
   - `Done`: タスク完了

2. サブタスクの状態
   - `Ready`: 実行可能な状態
   - `Blocked`: 依存するタスクが未完了
   - `In Progress`: 実行中
   - `Done`: 完了

3. 進捗管理
   - status.jsonで各サブタスクの状態を追跡
   - deps.jsonでサブタスク間の依存関係を管理
   - サブタスク完了時にステータスを自動更新

### 1.4 タスク実行フロー

1. タスク作成（Architectモード）
   - メインタスクの作成と分析
   - サブタスクへの分割
   - 依存関係の定義

2. サブタスク実行
   - 依存関係に基づく実行順序の決定
   - 各モードによるサブタスクの実行
   - 完了報告と進捗更新

3. タスク完了
   - すべてのサブタスク完了の確認
   - 最終成果物の整合性チェック 
   - タスクディレクトリの移動

## 2. 作業時の注意点

1. 作業を始める前に
   - docs/01-index.mdを参照
   - 必要なドキュメントを特定
   - 関連する実装の確認

2. ドキュメントの参照
   - docs/01-index.mdから必要な情報にたどり着く
   - 複数のドキュメントを横断的に確認
   - 実装とドキュメントの整合性を確認

3. 実装の変更時
   - 関連するドキュメントの特定
   - 変更内容の文書化

4. コマンド実行時の注意
   - コマンド発行前の確認事項：
     - ターミナルで使用されているshellの種類とバージョン
     - 使用中のターミナルの状態（実行中のプロセスの有無）
     - 各ターミナルの作業ディレクトリ
     - コマンドの実行結果の確認方法
   - コマンド実行時の注意点：
     - 必ずカレントディレクトリを確認
     - プロジェクトベースディレクトリ(dbunitcli/core)からの相対パスを意識
     - パスの指定は常に作業ディレクトリからの相対パスで行う