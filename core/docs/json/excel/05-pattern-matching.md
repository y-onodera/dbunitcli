# シートパターンマッチング

複数のシートに対して一括でテーブル構造を定義するための機能について説明します。

## 概要

シートパターンマッチングを使用すると、正規表現パターンを使用して複数のシートに同じテーブル構造を適用できます。
これは以下のような場合に特に有用です：

- データシートが月次や日次で作成される場合（例：data_202401, data_202402, ...）
- 同じ構造の複数シートでデータが分割されている場合（例：data_1, data_2, ...）
- 命名規則に従った複数のシートが存在する場合（例：summary_japan, summary_us, ...）

## JSON設定

```json
{
    "patterns": {
        "data_.*": "^data_\\d+$",      // シート名のパターン定義
        "summary": "summary_.*"         // 複数のパターンを定義可能
    },
    "rows": [
        {
            "sheetName": "data_.*",     // patternsで定義したパターンを指定
            "tableName": "DATA_TABLE",   // 共通のテーブル名
            "header": ["id", "name", "value"],
            "columnIndex": [0, 1, 2],
            "dataStart": 1
        }
    ]
}
```

### パターン定義

- `patterns`セクションで正規表現パターンとその別名を定義
- パターンは完全なJava正規表現をサポート
- パターン名は設定内で一意である必要がある

### テーブル定義での使用

- `sheetName`にパターン名を指定
- 同じテーブル構造を持つ全てのシートに設定が適用される
- 行テーブル定義、セルテーブル定義の両方でパターンを使用可能

## 使用例

### 月次データシートの一括定義

```json
{
    "patterns": {
        "monthly": "^data_202[0-9]{2}$"
    },
    "rows": [
        {
            "sheetName": "monthly",
            "tableName": "MONTHLY_DATA",
            "header": ["date", "amount", "category"],
            "columnIndex": [0, 1, 2],
            "dataStart": 1
        }
    ]
}
```

### 地域別サマリーシートの定義

```json
{
    "patterns": {
        "regional": "summary_[a-z]{2}$"
    },
    "rows": [
        {
            "sheetName": "regional",
            "tableName": "REGIONAL_SUMMARY",
            "header": ["region", "total", "ratio"],
            "columnIndex": [0, 1, 2],
            "dataStart": 1
        }
    ]
}
```

## 制限事項と注意点

1. パターンの優先順位
   - 複数のパターンが同じシート名にマッチする場合、最初に定義されたパターンが適用される
   - より具体的なパターンを先に定義することを推奨

2. パターンの検証
   - 実行前にパターンが意図したシートにマッチするか確認することを推奨
   - 誤ったパターンは予期しないシートの取り込みや除外の原因となる可能性がある

3. パフォーマンス
   - 多数のシートが存在する場合、パターンマッチングの処理に時間がかかる可能性がある
   - 必要以上に複雑なパターンを避けることを推奨