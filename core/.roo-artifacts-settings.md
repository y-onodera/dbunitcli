# 共通設定項目

## 1. データソース関連設定
データの読み込みに関する設定です。様々な形式（CSV、Excel、データベースなど）からのデータ読み込みに対応しています。

### DataSetLoadOption (src.*/new.*/old.*/param.*)
* -srcType: データソースタイプ - [詳細な設定](#srctype-datasourcetype)
* -src: データソースパス
* -setting: テーブル設定ファイルのパス - [スキーマ定義](.roo-artifacts-json-schema.md#1-比較設定ファイル-setting)
* -settingEncoding: 設定ファイルのエンコーディング（未指定時はシステムデフォルト）
* -regTableInclude: 含めるテーブルの正規表現パターン
* -regTableExclude: 除外するテーブルの正規表現パターン
* -loadData: データを読み込むかどうか（デフォルト: true）
* -includeMetaData: メタデータを含めるかどうか（デフォルト: false）
* -recursive: 再帰的に検索するかどうか（デフォルト: false）
* -regInclude: 含めるファイルの正規表現パターン
* -regExclude: 除外するファイルの正規表現パターン

### srcType (DataSourceType)
選択可能な値とそれぞれの追加オプション:

- csv: CSVファイル形式
  * -delimiter: 区切り文字（デフォルト: カンマ）
  * -ignoreQuoted: クォート処理を無視するかどうか
  * -encoding: 文字エンコーディング
  * -extension: 処理対象とする拡張子
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う）

- xls/xlsx: Excelファイル形式
  * -xlsxSchema: Excel形式定義ファイル - [スキーマ定義](.roo-artifacts-json-schema.md#2-excelスキーマファイル-xlsxschema)
  * -extension: 処理対象とする拡張子
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う）

- reg: 正規表現による解析
  * -regHeaderSplit: ヘッダー行の分割パターン
  * -regDataSplit: データ行の分割パターン
  * -encoding: 文字エンコーディング
  * -extension: 処理対象とする拡張子
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う）

- fixed: 固定長形式
  * -fixedLength: カラム長定義
  * -encoding: 文字エンコーディング
  * -extension: 処理対象とする拡張子
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う）

- csvq: CSVクォート付きファイル
  * -encoding: 文字エンコーディング
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う）
  * template.*: [テンプレート設定](#templaterenderoption-template)
  
- table/sql: データベーステーブル/SQL形式
  * -useJdbcMetaData: JDBCメタデータを使用するかどうか
  * jdbc.*: [データベース接続設定](#jdbc-データベース接続設定)
  * -encoding: 文字エンコーディング
  * -extension: 処理対象とする拡張子
  * -headerName: ヘッダー行の名前指定（指定がない場合は先頭行をヘッダーとして扱う)
  * template.*: [テンプレート設定](#templaterenderoption-template)

- dir: ディレクトリ
  * 固有のオプションなし

- file: ファイル
  * -extension: 処理対象とする拡張子

- none: データソースなし

## 2. 出力関連設定
処理結果の出力形式や出力先の制御に関する設定です。CSV、Excel、データベースなど、様々な形式での出力に対応しています。出力時のフォーマットやエンコーディングなども細かく制御できます。

### ResultOption (result.*)
* -resultType: 結果出力タイプ - [詳細な設定](#resulttype-結果出力形式)
* -resultDir: 結果出力ディレクトリ
* -outputEncoding: 出力エンコーディング

### resultType (結果出力形式)
選択可能な値とそれぞれの追加設定:

- csv: CSV形式で出力
  * -outputEncoding: 出力エンコーディング
  * -exportHeader: ヘッダー行を出力するかどうか
  * -exportEmptyTable: 空テーブルを出力するかどうか
  * 出力ファイル: [テーブル名].csv

- xls/xlsx: Excel形式で出力
  * -outputEncoding: 出力エンコーディング
  * -exportHeader: ヘッダー行を出力するかどうか
  * -exportEmptyTable: 空テーブルを出力するかどうか
  * -excelTable: テーブルの出力形式
    - SHEET: 1ブックに全テーブルを出力（シート分割）
    - BOOK: テーブルごとにブックを作成
  * 自動フォーマット設定:
    - 数値: スケールに応じて自動的にフォーマット設定
    - 日付: yyyy-MM-dd HH:mm:ss形式
  * フォント設定: MSゴシック、8ポイント

- table: DBを更新
  * - -operation: 更新方法
      * INSERT: INSERT
      * DELETE: DELETE
      * UPDATE: UPDATE
      * CLEAN_INSERT: TRUNCATE+INSERT
      * DELETE_INSERT: DELETE+INSERT
    - -commit: コミット有無（デフォルト: true）
  * - jdbc.*: [データベース接続設定](#jdbc-データベース接続設定)

### encoding.* (エンコーディング設定)
- -encoding: ファイルの文字エンコーディング
  * 未指定の場合はシステムのデフォルトエンコーディングを使用

## 3. データベース関連設定
データベースへの接続や操作に関する設定です。JDBC接続情報の指定方法や、SQL実行時のテンプレート処理などの設定が含まれます。

### jdbc.* (データベース接続設定)
以下のいずれかの方法で設定:
- -jdbcProperties: JDBC接続プロパティファイルのパス
  * url: 接続URL
  * user: ユーザー名
  * pass: パスワード
- または個別指定:
  * -jdbcUrl: JDBC接続URL
  * -jdbcUser: データベースユーザー名
  * -jdbcPass: データベースパスワード

### TemplateRenderOption (template.*)
テンプレートを使用したファイル生成やSQL実行時の設定です。変数の置換やフォーマット処理を制御します。

* 基本設定
  * -encoding: テンプレートのエンコーディング
  * -formulaProcess: 数式処理の有効化（Excel関連）
  * -templateGroup: テンプレートグループファイルのパス

* テンプレート変数の制御
  * -templateParameterAttribute: テンプレートパラメータの属性名（デフォルト: "param"）
  * -templateVarStart: テンプレート変数の開始文字（デフォルト: '$'）
  * -templateVarStop: テンプレート変数の終了文字（デフォルト: '$'）

使用例：
```bash
# 基本的なテンプレート処理
dbunit generate -generateType txt \
  -template.encoding "UTF-8" \
  -template.templateGroup "templates/common.stg" \
  -template.templateParameterAttribute "data"

# カスタム変数記号を使用
dbunit generate -generateType txt \
  -template.templateVarStart "@" \
  -template.templateVarStop "@" \
  -template.templateGroup "templates/custom.stg"
```

## 4. 画像比較設定
画像やPDFの比較時に使用する詳細な設定です。差分の検出方法や視覚的な表示方法を制御します。

### ImageCompareOption (image.*)
* 基本設定
  * -threshold: 画像比較の閾値（デフォルト: 5）
    - 値が大きいほど差分判定が緩くなります
    - 推奨範囲: 1-20
  * -pixelToleranceLevel: ピクセル許容レベル（デフォルト: 0.01）
    - 色の違いをどの程度許容するかを指定
    - 0.0-1.0の範囲で指定（0.0が完全一致）
  * -allowingPercentOfDifferentPixels: 許容される異なるピクセルの割合（デフォルト: 0.01）
    - 画像全体の何%まで差分を許容するか
    - 0.0-100.0の範囲で指定
  * -rectangleLineWidth: 差分表示用の四角形の線幅（デフォルト: 1）
  * -minimalRectangleSize: 差分として検出する最小の四角形サイズ（デフォルト: 1）
    - 小さすぎる差分を無視したい場合に調整
  * -maximalRectangleCount: 差分として検出する最大の四角形数（デフォルト: -1, 無制限）
    - パフォーマンス調整に使用

* 差分表示の設定
  * -fillDifferenceRectangles: 差分を示す四角形を塗りつぶすかどうか（デフォルト: false）
  * -percentOpacityDifferenceRectangles: 差分四角形の透明度（デフォルト: 20.0）
    - 0.0-100.0の範囲で指定（0.0が完全透明）
  * -differenceRectangleColor: 差分四角形の色（デフォルト: red）

* 除外領域の設定
  * -excludedAreas: 比較から除外する領域（書式: [x,y,width,height][x,y,width,height]...）
  * -drawExcludedRectangles: 除外領域を描画するかどうか（デフォルト: true）
  * -fillExcludedRectangles: 除外領域を塗りつぶすかどうか（デフォルト: false）
  * -percentOpacityExcludedRectangles: 除外領域の透明度（デフォルト: 20.0）
  * -excludedRectangleColor: 除外領域の色（デフォルト: green）

使用例：
```bash
# 高精度な画像比較
dbunit compare -targetType image \
  -new.src new_image.png \
  -old.src old_image.png \
  -image.threshold 3 \
  -image.pixelToleranceLevel 0.001 \
  -image.allowingPercentOfDifferentPixels 0.0

# 特定領域を除外した比較
dbunit compare -targetType image \
  -new.src new_image.png \
  -old.src old_image.png \
  -image.excludedAreas "[0,0,100,50][200,300,50,50]" \
  -image.fillExcludedRectangles true \
  -image.percentOpacityExcludedRectangles 30.0